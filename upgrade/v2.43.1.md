# MainNet v2.43.0 -> v2.43.1 Pre-Upgrade Instructions

**The following patch is necessary if you are running our oracle service.**

<h2>
Check if you are running your oracle service on a separate machine
</h2>

Run the following command inside your **VALIDATOR NODE**:
<br><br>
    ```
    cat /etc/systemd/system/carbond.service | grep Wants=carbond@oracle.service
    ```

<h3>
If you get the following response:
</h3>

`Wants=carbond@oracle.service` -> you are running your oracle service and validator on the **SAME** machine.

<h3>
If you get no response:
</h3>

you are running your oracle service and validator on **DIFFERENT** machines.

<br>

<h2>
:exclamation:If you run your oracle service and validator node on the **SAME** machine, follow these instructions :exclamation:
</h2>

<details>
<summary> Instructions </summary>
<h3>
1. Run the following commands on your **VALIDATOR NODE** to generate ssl configurations, that will be used to authenticate GRPC server.
</h3>

    VALIDATOR_NODE_IP_ADDRESS="127.0.0.1"         
    ORACLE_SERVICE_NODE_IP_ADDRESS="127.0.0.1"    
    CARBON_HOME_PATH="~/.carbon"         # change to your own directory path where the .carbon directory is found
    URL=https://raw.githubusercontent.com/switcheo/carbon-bootstrap/master/scripts/cert.sh
    bash <(wget -O - $URL) $VALIDATOR_NODE_IP_ADDRESS $ORACLE_SERVICE_NODE_IP_ADDRESS $CARBON_HOME_PATH

<h3>
:bulb: If you wish to disable the gRPC authentication, follow these instructions. :bulb:
</h3>

<h4>
Update your app.toml config in `~/.carbon/config/app.toml`, under `gRPC Configuration`.
</h4>
    
    Set the following field `enable-oracle-grpc-auth` to `false`:

    # EnableOracleGrpcAuth defines if the gRPC server for oracle votes communication should be ssl authenticated.
    enable-oracle-grpc-auth = false

    Restart **BOTH** your oracle service and validator node if they are running.
</details>

<h2>
:exclamation: If you run your oracle service and validator node on **DIFFERENT** machines, follow these instructions instead :exclamation:
</h2>

<details>
<summary> Instructions </summary>
<h3> 1. Run the following command on your **VALIDATOR NODE** to generate ssl configurations, that will be used to authenticate GRPC server.
</h3>

<h4>
:exclamation: Update the following fields, `VALIDATOR_NODE_IP_ADDRESS` and `ORACLE_SERVICE_NODE_IP_ADDRESS` with the private IP address of each machine. :exclamation:
</h4>

    VALIDATOR_NODE_IP_ADDRESS=""         # change to val node ip address if you run oracle service separately 
    ORACLE_SERVICE_NODE_IP_ADDRESS=""    # change to oracle service node ip address if you run val node separately
    CARBON_HOME_PATH="~/.carbon"         # change to your own directory path where the .carbon directory is found
    URL=https://raw.githubusercontent.com/switcheo/carbon-bootstrap/master/scripts/cert.sh
    bash <(wget -O - $URL) $VALIDATOR_NODE_IP_ADDRESS $ORACLE_SERVICE_NODE_IP_ADDRESS $CARBON_HOME_PATH

<br>
<h3>2. Run the following command on your **ORACLE NODE** to transfer the ssl certificates to your oracle node. </h3>

<h4>
:exclamation: Update the following fields, `VALIDATOR_NODE_IP_ADDRESS` and `HOST_NAME` with the private IP address and the Host Name of your validator node. :exclamation:
</h4>

:bulb: Update the file paths accordingly if your id_rsa key, and carbon home directory are stored differently. (If ssh entry to your nodes do not require verification, you can remove the -i option, can omit `-i ~/.ssh/id_rsa `) :bulb:

```bash
scp -r -i ~/.ssh/id_rsa  HOST_NAME@VALIDATOR_NODE_IP_ADDRESS:~/.carbon/config/cert ~/.carbon/config/cert 
```

<br>

<h3>
3. Starting up your oracle service
</h3>

When running your oracle service, you now have to supply an additional flag for the new grpc url, on top of the old one:

To check which gRPC IP address your oracle service was previously using, run the following command inside your **ORACLE SERVICE NODE**:

```
cat /etc/systemd/system/carbond@.service | grep grpc-url
```
<h4>
If you get the following response:
</h4>

`ExecStart=/home/ubuntu/.carbon/cosmovisor/current/bin/carbond %i --grpc-url GRPC_IP_ADDRESS`

Note down and copy the value labeled `GRPC_IP_ADDRESS`, and follow these instructions:

<details>
<summary> Instructions </summary>

<h4>
:exclamation: Update the following fields, `VALIDATOR_NODE_IP_ADDRESS` with the private IP address of your validator node, and `GRPC_IP_ADDRESS` with the IP address value you retrieved earlier. :exclamation:
</h4>

```
carbond oracle --grpc-url GRPC_IP_ADDRESS:9090 --oracle-grpc-url VALIDATOR_NODE_IP_ADDRESS:9093
```

</details>

<h4>
If you get no response, follow these instructions instead:
</h4>

<details>
<summary> Instructions </summary>

<h4>
:exclamation: Update the following field, `VALIDATOR_NODE_IP_ADDRESS` with the private IP address of your validator node. :exclamation:
</h4>

```
carbond oracle --oracle-grpc-url VALIDATOR_NODE_IP_ADDRESS:9093
```

</details>

<h3>
:bulb: If you wish to disable the gRPC authentication, follow these instructions. :bulb:
</h3>

Update your app.toml config in `~/.carbon/config/app.toml`, under `gRPC Configuration`, on **BOTH VALIDATOR NODE AND ORACLE SERVICE NODE**
    
    Set the following field `enable-oracle-grpc-auth` to `false`:

    ```
    # EnableOracleGrpcAuth defines if the gRPC server for oracle votes communication should be ssl authenticated.
    enable-oracle-grpc-auth = false
    ```

    Restart **BOTH** your oracle service and validator node if they are running.

</details>
